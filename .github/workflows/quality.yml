name: Rust Code Quality

on:
  pull_request:
    branches: "**"
  workflow_dispatch:

jobs:
  quality-check:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Clone du d√©p√¥t
      - uses: actions/checkout@v4
        # run: |
        #   git clone ${{ github.server_url }}/${{ github.repository }} .
        #   git fetch --all

      - name: üõ†Ô∏è Installer Rust
        run: |
          curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain 1.87.0
          source $HOME/.cargo/env
          rustup component add rustfmt clippy
          cargo install cargo-audit

      - name: ‚úÖ V√©rification version (rustfmt)
        run: |
          source $HOME/.cargo/env
          cargo fmt --version

      - name: ‚úÖ V√©rification ash (rustfmt)
        run: |
          source $HOME/.cargo/env
          shasum simeis-server/src/api.rs

      - name: ‚úÖ V√©rification formatage (rustfmt)
        run: |
          source $HOME/.cargo/env
          cargo fmt --check

      - name: üîç Linting (clippy)
        run: |
          source $HOME/.cargo/env
          cargo clippy

      - name: üõ°Ô∏è Audit de s√©curit√©
        run: |
          source $HOME/.cargo/env
          cargo audit
